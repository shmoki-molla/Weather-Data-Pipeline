# Weather-Data-Pipeline

–≠—Ç–æ—Ç –ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤–æ-–±–∞—Ç—á–µ–≤–æ–≥–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ –¥–ª—è —Å–±–æ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ.  
–û—Å–Ω–æ–≤–Ω–æ–π —É–ø–æ—Ä ‚Äî –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é **Kafka**, **Airflow**, **PySpark**, **PostgreSQL**, **ClickHouse** –∏ **Superset**, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ **Docker**.

![—Å—Ö–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–∞](assets/—Å—Ö–µ–º–∞.jpg)
---

## üöÄ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∫–≤–æ–∑–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω:

1. **PostgreSQL** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ "—Å—ã—Ä—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ.  
   –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å—Ö–µ–º–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π `weather_data`.

2. **ClickHouse** ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤–∏—Ç—Ä–∏–Ω.  
   –°–æ–∑–¥–∞—é—Ç—Å—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

3. **Kafka** ‚Äî –ø–æ—Ç–æ–∫–æ–≤—ã–π —à–∏–Ω—É –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö:
   - **producer DAG** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–≥–æ–¥–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ —Ç–æ–ø–∏–∫ Kafka —Å –ø–æ–º–æ—â—å—é Spark Streaming.
   - **consumer DAG** —á–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ PostgreSQL.

4. **PySpark**:
   - Streaming ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ producer-DAG.
   - Batch ‚Äî –∑–∞–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL, –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–µ–¥–Ω–µ—Å—É—Ç–æ—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ ClickHouse.

5. **Airflow** ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è DAG‚Äô–æ–≤:
   - `init_postgres_dag`  
   - `init_clickhouse_dag`  
   - `producer_api_dag`
   - `consumer_psql_dag`
   - `clickhouse_spark_batch_dag`
   - `master_dag`

6. **Superset** ‚Äî BI-–≤–∏—Ç—Ä–∏–Ω–∞.  
   –ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ClickHouse —Å—Ç—Ä–æ–∏—Ç—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥.

---

## üß© –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞

### üîπ 1. Producer DAG
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Spark Streaming.
- –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ –∏–∑ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ API.
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π.
- –ü—É–±–ª–∏–∫—É–µ—Ç –∏—Ö –≤ Kafka-—Ç–æ–ø–∏–∫ `weather-topic`.

### üîπ 2. Consumer DAG
- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka.
- –ü—Ä–∏–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ –∫ —Ç–∞–±–ª–∏—á–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ –≤ PostgreSQL (`weather_data`).

### üîπ 3. Batch DAG
- PySpark-–∑–∞–¥–∞–Ω–∏–µ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ PostgreSQL.
- –î–µ–ª–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã (—Å—Ä–µ–¥–Ω—è—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ –≥–æ—Ä–æ–¥—É –∑–∞ —á–∞—Å/—Å—É—Ç–∫–∏, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Ç.–¥.).
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–µ –≤–∏—Ç—Ä–∏–Ω—ã –≤ ClickHouse.

### üîπ 4. –î–∞—à–±–æ—Ä–¥
- –ß–µ—Ä–µ–∑ Superset –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è ClickHouse.
- –°—Ç—Ä–æ—è—Ç—Å—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:  
  ‚úî –¥–∏–Ω–∞–º–∏–∫–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã  
  ‚úî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤  
  ‚úî —Ç—Ä–µ–Ω–¥—ã –ø–æ –¥–Ω—è–º/—á–∞—Å–∞–º  
  ‚úî –∫–∞—Ä—Ç–∞ –∏–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤  

---

## üì¶ Docker-–∫–æ–º–ø–æ–∑–∏—Ü–∏—è

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã ‚Äî Airflow, Kafka, Zookeeper, Spark, PostgreSQL, ClickHouse, Superset ‚Äî –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
docker compose up -d
